import{c as P,W as A,r as i,j as e,a as F,d as O}from"./app-CmMHBtRm.js";import{A as $}from"./AuthenticatedLayout-BMwXgHnR.js";import"./transition-t7xN9JIs.js";import"./index-BFRJqtLk.js";import"./js.cookie-Cz0CWeBA.js";const B=()=>{const d={current:{type:"",message:"",data:""}},c=P("unityPreview");return c.addEventListener("open",n=>{}),c.addEventListener("message",n=>{const x=JSON.parse(n.data);d.current=x.message;try{d.current.message,d.current,d.current.type}catch{return}}),c},m={data:{x:0,y:0}},v={data:{x:0,y:0}};let g={x:0,y:0};const J=(d,c,n)=>{let x=!1,o={x:0,y:0};const r=d;v.data=m.data;async function p(s){x=!0,o.x=s.clientX-r.getBoundingClientRect().x,o.y=s.clientY-r.getBoundingClientRect().y,r.style.cursor="grabbing",g.x=r.getBoundingClientRect().x,g.y=r.getBoundingClientRect().y,await j(),document.addEventListener("mousemove",a),document.addEventListener("mouseup",u),v.data=m.data}async function a(s){x&&(r.style.left=s.clientX-o.x+"px",r.style.top=s.clientY-o.y-130+"px",g.x=s.clientX-o.x,g.y=s.clientY-o.y,await j(),console.log(v.data.x-m.data.x))}async function j(){const s=g.x/2/10,k=g.y/2/10-7,w={position:{x:Math.floor(s),y:Math.floor(k)}};m.data={...w.position}}function u(s){x=!1,r.style.cursor="grab",g.x=r.getBoundingClientRect().x,g.y=r.getBoundingClientRect().y,j(),c.send(JSON.stringify({type:"movingPart",message:r.getAttribute("title"),data:{user_id:n,position:{x:Math.floor(v.data.x-m.data.x),y:Math.floor(v.data.y-m.data.y)}}})),v.data=m.data,document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",u)}r.addEventListener("mousedown",p)},{getDomain:q,setDomain:W,getDomainString:T}=require("DomainProvider.cjs"),U=async d=>{try{return(await(await fetch(d,{headers:{"api-key":"YOUR_SECRET_API_KEY"}})).json()).data}catch(c){throw console.error("Error fetching or parsing JSON:",c),c}},G=d=>{const c=document.querySelector(".place");c.innerHTML="",d.forEach((n,x)=>{const o=document.createElement("span");o.setAttribute("title","Device:"+n.name),o.classList.add("placement");const r={position:{x:Number(n.position.x),y:Number(n.position.y),z:Number(n.position.z)}},p={position:{x:Math.floor(Number(n.position.x)),y:Math.floor(Number(n.position.y)),z:Math.floor(Number(n.position.z))}},a="rgb("+(225-p.position.x)+","+(225-p.position.y)+","+(225-p.position.z)+")";o.setAttribute("style","right: "+r.position.x+"rem; top: "+r.position.z+"rem; background: "+a+";"),c.append(o)})},Y=async(d,c)=>{const n=[],x=[],o=`http://${T()}/api/fetch-placement?id=${c.name}`;try{const r=await U(o),p=document.querySelector(".place");p.innerHTML="",r.data.devicesSp.forEach((a,j)=>{const u=document.createElement("span"),s={name:a.name,position:{x:parseFloat(a.position.x).toFixed(3),y:parseFloat(a.position.y).toFixed(3),z:parseFloat(a.position.z).toFixed(3)}},k={position:{x:a.position.x,y:a.position.y,z:a.position.z}};n.push(s),x.push(u),J(u,d,c),u.setAttribute("value",JSON.stringify({data:s})),u.setAttribute("title","Device:"+a.name);const w="rgb("+(225-s.position.x)+","+(225-s.position.y)+","+(225-s.position.z)+")";u.classList.add("placement");const h=750+s.position.x*20*10,S=750+s.position.z*20*10,b={x:h,y:S};u.setAttribute("vect2",JSON.stringify(b)),u.setAttribute("style","z-index:40; left:"+h+"px; bottom:"+S+"px; background:"+w+";"),p.append(u)})}catch(r){console.log(r)}return{arr:n,elements:x}},K=({auth:d})=>{const{data:c,setData:n,post:x}=A(),o=i.useRef(null),[r,p]=i.useState([]),[a,j]=i.useState(!1);i.useRef([]);const u=i.useRef([]);i.useState("yo"),i.useRef(null),i.useRef(null);const s=i.useRef(null);async function k(){try{a?G(messageArr.current,s.current):(o.current=await Y(s.current,d.user),p(o.current.elements),u.current=o.current.elements)}catch(t){console.error("Error loading data:",t)}}i.useEffect(()=>{s.current=B()},[]);async function w(t,l){t.preventDefault();const f={data:l.map(y=>JSON.parse(y.getAttribute("value")).data)};try{await x(route("unity.move",f)),f.data=[]}catch(y){console.error("Error posting data:",y)}}i.useEffect(()=>{k()},[a]);const[h,S]=i.useState(),[b,R]=i.useState(),N=i.useRef(),z=t=>{if(t.target.nodeName==="SPAN"&&t.target.classList.contains("placement")){S(t.target);const{data:l}=N.current=JSON.parse(t.target.attributes[0].nodeValue),f={id:t.target.id,className:t.target.className,data:l};N.current=f,N&&R(N.current.data.position)}};i.useEffect(()=>(window.addEventListener("mousedown",z),()=>{window.removeEventListener("mousedown",z)}),[]);const C=({layer:t})=>{const[l,f]=i.useState(!0),y=()=>{f(!l)};return e.jsxs("div",{children:[e.jsx("button",{className:"fixed top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded shadow",onClick:y,children:l?"Hide Guide":"Show Guide"}),l&&e.jsxs("div",{className:`max-w-xl mx-auto px-4 py-8 fixed top-20 right-4 ${t} text-gray-800 dark:text-white bg-white dark:bg-gray-800 rounded shadow-lg`,children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500",onClick:y,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Step 1: Click to Start"}),e.jsx("p",{children:"Click on the Circles to initiate control."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Step 2: Drag to Move"}),e.jsx("p",{children:"Once the Circle is clicked, drag your mouse in the desired direction to move the Device."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Step 3: Release to Stop"}),e.jsx("p",{children:"Release the mouse button to stop the Device's movement."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Step 4: Normalize Positions To Unity"}),e.jsx("button",{className:"dark:bg-orange-500 bg-blue-500 hover:text-gray-200 dark:text-gray-800 hover:font-bold p-2 rounded shadow-md",children:e.jsx(O,{href:route("unity.index"),children:"Normalize"})})]}),e.jsxs("div",{className:"bg-blue-100 text-blue-700 border border-blue-300 rounded p-4 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Important Note:"}),e.jsx("p",{children:"Ensure that you have a stable internet connection for optimal performance."})]})]})]})},L=({Device:t})=>{const l={x:-100,y:0};return t&&(l.x=t.getBoundingClientRect().left,l.y=t.getBoundingClientRect().top),e.jsx("div",{className:"absolute border-2 border-indigo-500 z-10 p-4 rounded-full",style:{width:"25px",height:"25px",top:l.y-5.5,left:l.x-6}})},[D,E]=i.useState(!1),M=t=>{t.preventDefault(),E(!D)};return e.jsx(e.Fragment,{children:e.jsxs($,{user:d.user,header:e.jsx("h2",{className:"dark:text-white",children:"Devices Placement"}),children:[e.jsx(F,{title:"Unity Details"}),e.jsx(L,{Device:h}),e.jsx("div",{className:"place",onMouseDown:t=>{t.preventDefault(),E(!D)}}),e.jsx(C,{layer:"z-10"}),a?e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Retrieve from Unity Live Client"}),e.jsx("ul",{children:messageArr.current.map((t,l)=>e.jsx("li",{children:`ID:${l} position: Vector3 (x: ${t.position.x}, y: ${t.position.y}, z: ${t.position.z})`},l))})]}):e.jsxs(e.Fragment,{children:[o.current?e.jsxs("div",{className:"text-white dark:text-white w-fit z-10 fixed",children:[e.jsx("button",{className:"p-4 bg-gray-300",onClick:t=>w(t,u.current),children:"Sync positions"}),e.jsx("h2",{children:"Retrieve from JSON Generated file"})]}):e.jsx(e.Fragment,{children:e.jsx("h2",{children:"Retrieve from Unity Live Client, JSON Fail"})}),N.current&&!D&&b&&e.jsxs("div",{className:"fixed bottom-4 left-4 z-50 dark:text-white bg-white dark:bg-gray-800 shadow-md rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full"}),e.jsx("h1",{className:"text-lg font-semibold",children:"Device Details"}),e.jsx("button",{onClick:t=>{M(t)},className:"text-gray-600 hover:text-gray-800 focus:outline-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h.attributes&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dark:bg-gray-700 border-2 border-indigo-500 dark:text-gray-300 rounded-md p-2 mb-2",children:e.jsx("h2",{className:"text-sm font-semibold",children:h.attributes[1].nodeValue})}),e.jsx("div",{className:"dark:bg-gray-700 border-2 border-indigo-500 dark:text-gray-300 rounded-md p-2 mb-2",children:e.jsx("h2",{className:"text-sm font-semibold",children:h.attributes[0].nodeValue})})]}),e.jsxs("div",{className:"dark:bg-gray-700 border-2 border-indigo-500 dark:text-gray-300 rounded-md p-2 mb-2",children:[e.jsx("h2",{className:"text-sm font-semibold",children:`Vector3: {${parseFloat(b.x).toFixed(3)}, ${parseFloat(b.y).toFixed(3)}, ${parseFloat(b.z).toFixed(3)}}`}),e.jsx("h3",{className:"text-xs",children:`Vector2: {${Math.floor(m.data.x)}, ${Math.floor(m.data.y)}}`})]})]})]}),e.jsx("style",{children:`
                    *{
                        user-select: none;
                    }
                    .placement {
                        position: absolute;
                        display: block;
                        width: 1.5rem;
                        height: 1.5rem;
                        border-radius:100%;
                        z-index:11;
                    }
                    .placement:hover {
                        background: red !important;
                    }
                    .place {
                        position: relative;
                        top: 0;
                        z-index: 9;
                        width: 100%;
                        height: 100vh;
                        background-image: linear-gradient(rgba(255, 255, 255, 0) 1px, #8f8f8f  1px), linear-gradient(90deg, rgba(255, 255, 255, 0) 1px, #8f8f8f 1px);
                        background-size: 20px 20px;
                    }
                    @media (prefers-color-scheme: dark) {
                        .place {
                            background-image: linear-gradient(rgba(255, 255, 255, 0) 1px, white  1px), linear-gradient(90deg, rgba(255, 255, 255, 0) 1px, white 1px);
                        }
                        .placement{
                            background: #8996a9 ;
                        }
                      
                      
                      }
                      @media (prefers-color-scheme: light) {
                        .place {
                            background-image: linear-gradient(rgba(255, 255, 255, 0) 1px, #8f8f8f  1px), linear-gradient(90deg, rgba(255, 255, 255, 0) 1px, #8f8f8f 1px);
                        }
                        .placement{
                            background: blue ;
                        }
                      
                      }
                `})]})})};export{K as default};
